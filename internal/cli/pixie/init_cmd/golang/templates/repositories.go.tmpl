package {{.DomainName}}_repositories

import (
	"github.com/pixie-sh/core-go/pkg/uid"
	"github.com/pixie-sh/database-helpers-go/database"
	"gorm.io/gorm"

	"{{.ModuleName}}/internal/domains/{{.DomainName}}/{{.DomainName}}_data_layer/{{.DomainName}}_entities"
)

type {{.RepositoryNameCamel}}Repository struct {
    database.Repository[{{.RepositoryNameCamel}}Repository]

	db *gorm.DB
}

func New{{.RepositoryNameCamel}}Repository(db *gorm.DB) *{{.RepositoryNameCamel}}Repository {
	return &{{.RepositoryNameCamel}}Repository{
		db: db,
	}
}

// Create creates a new {{.EntityName}} record
func (r *{{.RepositoryNameCamel}}Repository) Create({{.EntityName}} *{{.DomainName}}_entities.{{.EntityNameCamel}}) error {
	return r.db.Create({{.EntityName}}).Error
}

// GetByID retrieves a {{.EntityName}} by ID
func (r *{{.RepositoryNameCamel}}Repository) GetByID(id uid.UID) (*{{.DomainName}}_entities.{{.EntityNameCamel}}, error) {
	var {{.EntityName}} {{.DomainName}}_entities.{{.EntityNameCamel}}
	err := r.db.Where("id = ?", id).First(&{{.EntityName}}).Error
	if err != nil {
		return nil, err
	}
	return &{{.EntityName}}, nil
}

// GetAll retrieves all {{.EntityName}} records
func (r *{{.RepositoryNameCamel}}Repository) GetAll() ([]*{{.DomainName}}_entities.{{.EntityNameCamel}}, error) {
	var {{.EntityName}}s []*{{.DomainName}}_entities.{{.EntityNameCamel}}
	err := r.db.Find(&{{.EntityName}}s).Error
	return {{.EntityName}}s, err
}

{{- if .Features.auth}}
// GetByUserID retrieves {{.EntityName}} records by user ID
func (r *{{.RepositoryNameCamel}}Repository) GetByUserID(userID uid.UID) ([]*{{.DomainName}}_entities.{{.EntityNameCamel}}, error) {
	var {{.EntityName}}s []*{{.DomainName}}_entities.{{.EntityNameCamel}}
	err := r.db.Where("user_id = ?", userID).Find(&{{.EntityName}}s).Error
	return {{.EntityName}}s, err
}
{{- end}}

// Update updates a {{.EntityName}} record
func (r *{{.RepositoryNameCamel}}Repository) Update({{.EntityName}} *{{.DomainName}}_entities.{{.EntityNameCamel}}) error {
	return r.db.Save({{.EntityName}}).Error
}

// Delete deletes a {{.EntityName}} record
func (r *{{.RepositoryNameCamel}}Repository) Delete(id uid.UID) error {
	return r.db.Where("id = ?", id).Delete(&{{.DomainName}}_entities.{{.EntityNameCamel}}{}).Error
}

// Exists checks if a {{.EntityName}} record exists
func (r *{{.RepositoryNameCamel}}Repository) Exists(id uid.UID) (bool, error) {
	var count int64
	err := r.db.Model(&{{.DomainName}}_entities.{{.EntityNameCamel}}{}).Where("id = ?", id).Count(&count).Error
	return count > 0, err
}
